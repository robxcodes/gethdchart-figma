<div class="container">
  <svg width="142" height="25" viewBox="0 0 142 25" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M7.128 4.56C8.152 4.56 9.056 4.768 9.84 5.184C10.64 5.584 11.264 6.088 11.712 6.696V4.776H14.472V18.216C14.472 19.432 14.216 20.512 13.704 21.456C13.192 22.416 12.448 23.168 11.472 23.712C10.512 24.256 9.36 24.528 8.016 24.528C6.224 24.528 4.736 24.104 3.552 23.256C2.368 22.424 1.696 21.288 1.536 19.848H4.248C4.456 20.536 4.896 21.088 5.568 21.504C6.256 21.936 7.072 22.152 8.016 22.152C9.12 22.152 10.008 21.816 10.68 21.144C11.368 20.472 11.712 19.496 11.712 18.216V16.008C11.248 16.632 10.616 17.16 9.816 17.592C9.032 18.008 8.136 18.216 7.128 18.216C5.976 18.216 4.92 17.928 3.96 17.352C3.016 16.76 2.264 15.944 1.704 14.904C1.16 13.848 0.888 12.656 0.888 11.328C0.888 10 1.16 8.824 1.704 7.8C2.264 6.776 3.016 5.984 3.96 5.424C4.92 4.848 5.976 4.56 7.128 4.56ZM11.712 11.376C11.712 10.464 11.52 9.672 11.136 9C10.768 8.328 10.28 7.816 9.672 7.464C9.064 7.112 8.408 6.936 7.704 6.936C7 6.936 6.344 7.112 5.736 7.464C5.128 7.8 4.632 8.304 4.248 8.976C3.88 9.632 3.696 10.416 3.696 11.328C3.696 12.24 3.88 13.04 4.248 13.728C4.632 14.416 5.128 14.944 5.736 15.312C6.36 15.664 7.016 15.84 7.704 15.84C8.408 15.84 9.064 15.664 9.672 15.312C10.28 14.96 10.768 14.448 11.136 13.776C11.52 13.088 11.712 12.288 11.712 11.376ZM30.9056 11.064C30.9056 11.56 30.8736 12.008 30.8096 12.408H20.7056C20.7856 13.464 21.1776 14.312 21.8816 14.952C22.5856 15.592 23.4496 15.912 24.4736 15.912C25.9456 15.912 26.9856 15.296 27.5936 14.064H30.5456C30.1456 15.28 29.4176 16.28 28.3616 17.064C27.3216 17.832 26.0256 18.216 24.4736 18.216C23.2096 18.216 22.0736 17.936 21.0656 17.376C20.0736 16.8 19.2896 16 18.7136 14.976C18.1536 13.936 17.8736 12.736 17.8736 11.376C17.8736 10.016 18.1456 8.824 18.6896 7.8C19.2496 6.76 20.0256 5.96 21.0176 5.4C22.0256 4.84 23.1776 4.56 24.4736 4.56C25.7216 4.56 26.8336 4.832 27.8096 5.376C28.7856 5.92 29.5456 6.688 30.0896 7.68C30.6336 8.656 30.9056 9.784 30.9056 11.064ZM28.0496 10.2C28.0336 9.192 27.6736 8.384 26.9696 7.776C26.2656 7.168 25.3936 6.864 24.3536 6.864C23.4096 6.864 22.6016 7.168 21.9296 7.776C21.2576 8.368 20.8576 9.176 20.7296 10.2H28.0496ZM37.5101 7.008V14.328C37.5101 14.824 37.6221 15.184 37.8461 15.408C38.0861 15.616 38.4861 15.72 39.0461 15.72H40.7261V18H38.5661C37.3341 18 36.3901 17.712 35.7341 17.136C35.0781 16.56 34.7501 15.624 34.7501 14.328V7.008H33.1901V4.776H34.7501V1.488H37.5101V4.776H40.7261V7.008H37.5101ZM76.3474 11.376C76.3474 10.016 76.6194 8.824 77.1634 7.8C77.7234 6.76 78.4914 5.96 79.4674 5.4C80.4434 4.84 81.5634 4.56 82.8274 4.56C84.4274 4.56 85.7474 4.944 86.7874 5.712C87.8434 6.464 88.5554 7.544 88.9234 8.952H85.9714C85.7314 8.296 85.3474 7.784 84.8194 7.416C84.2914 7.048 83.6274 6.864 82.8274 6.864C81.7074 6.864 80.8114 7.264 80.1394 8.064C79.4834 8.848 79.1554 9.952 79.1554 11.376C79.1554 12.8 79.4834 13.912 80.1394 14.712C80.8114 15.512 81.7074 15.912 82.8274 15.912C84.4114 15.912 85.4594 15.216 85.9714 13.824H88.9234C88.5394 15.168 87.8194 16.24 86.7634 17.04C85.7074 17.824 84.3954 18.216 82.8274 18.216C81.5634 18.216 80.4434 17.936 79.4674 17.376C78.4914 16.8 77.7234 16 77.1634 14.976C76.6194 13.936 76.3474 12.736 76.3474 11.376ZM99.21 4.56C100.218 4.56 101.114 4.776 101.898 5.208C102.698 5.64 103.322 6.28 103.77 7.128C104.234 7.976 104.466 9 104.466 10.2V18H101.754V10.608C101.754 9.424 101.458 8.52 100.866 7.896C100.274 7.256 99.466 6.936 98.442 6.936C97.418 6.936 96.602 7.256 95.994 7.896C95.402 8.52 95.106 9.424 95.106 10.608V18H92.37V0.24H95.106V6.312C95.57 5.752 96.154 5.32 96.858 5.016C97.578 4.712 98.362 4.56 99.21 4.56ZM107.764 11.328C107.764 10 108.036 8.824 108.58 7.8C109.14 6.776 109.892 5.984 110.836 5.424C111.796 4.848 112.852 4.56 114.004 4.56C115.044 4.56 115.948 4.768 116.716 5.184C117.5 5.584 118.124 6.088 118.588 6.696V4.776H121.348V18H118.588V16.032C118.124 16.656 117.492 17.176 116.692 17.592C115.892 18.008 114.98 18.216 113.956 18.216C112.82 18.216 111.78 17.928 110.836 17.352C109.892 16.76 109.14 15.944 108.58 14.904C108.036 13.848 107.764 12.656 107.764 11.328ZM118.588 11.376C118.588 10.464 118.396 9.672 118.012 9C117.644 8.328 117.156 7.816 116.548 7.464C115.94 7.112 115.284 6.936 114.58 6.936C113.876 6.936 113.22 7.112 112.612 7.464C112.004 7.8 111.508 8.304 111.124 8.976C110.756 9.632 110.572 10.416 110.572 11.328C110.572 12.24 110.756 13.04 111.124 13.728C111.508 14.416 112.004 14.944 112.612 15.312C113.236 15.664 113.892 15.84 114.58 15.84C115.284 15.84 115.94 15.664 116.548 15.312C117.156 14.96 117.644 14.448 118.012 13.776C118.396 13.088 118.588 12.288 118.588 11.376ZM128.398 6.696C128.798 6.024 129.326 5.504 129.982 5.136C130.654 4.752 131.446 4.56 132.358 4.56V7.392H131.662C130.59 7.392 129.774 7.664 129.214 8.208C128.67 8.752 128.398 9.696 128.398 11.04V18H125.662V4.776H128.398V6.696ZM138.784 7.008V14.328C138.784 14.824 138.896 15.184 139.12 15.408C139.36 15.616 139.76 15.72 140.32 15.72H142V18H139.84C138.608 18 137.664 17.712 137.008 17.136C136.352 16.56 136.024 15.624 136.024 14.328V7.008H134.464V4.776H136.024V1.488H138.784V4.776H142V7.008H138.784Z"
      fill="#413E3E" />
    <path
      d="M50.8078 4.56C51.8158 4.56 52.7118 4.776 53.4958 5.208C54.2958 5.64 54.9198 6.28 55.3678 7.128C55.8318 7.976 56.0638 9 56.0638 10.2V18H53.3518V10.608C53.3518 9.424 53.0558 8.52 52.4638 7.896C51.8718 7.256 51.0638 6.936 50.0398 6.936C49.0158 6.936 48.1998 7.256 47.5918 7.896C46.9998 8.52 46.7038 9.424 46.7038 10.608V18H43.9678V0.24H46.7038V6.312C47.1678 5.752 47.7518 5.32 48.4558 5.016C49.1758 4.712 49.9598 4.56 50.8078 4.56ZM59.3618 11.328C59.3618 10 59.6338 8.824 60.1778 7.8C60.7378 6.776 61.4898 5.984 62.4338 5.424C63.3938 4.848 64.4578 4.56 65.6258 4.56C66.4898 4.56 67.3378 4.752 68.1698 5.136C69.0178 5.504 69.6898 6 70.1858 6.624V0.24H72.9458V18H70.1858V16.008C69.7378 16.648 69.1138 17.176 68.3138 17.592C67.5298 18.008 66.6258 18.216 65.6018 18.216C64.4498 18.216 63.3938 17.928 62.4338 17.352C61.4898 16.76 60.7378 15.944 60.1778 14.904C59.6338 13.848 59.3618 12.656 59.3618 11.328ZM70.1858 11.376C70.1858 10.464 69.9938 9.672 69.6098 9C69.2418 8.328 68.7538 7.816 68.1458 7.464C67.5378 7.112 66.8818 6.936 66.1778 6.936C65.4738 6.936 64.8178 7.112 64.2098 7.464C63.6018 7.8 63.1058 8.304 62.7218 8.976C62.3538 9.632 62.1698 10.416 62.1698 11.328C62.1698 12.24 62.3538 13.04 62.7218 13.728C63.1058 14.416 63.6018 14.944 64.2098 15.312C64.8338 15.664 65.4898 15.84 66.1778 15.84C66.8818 15.84 67.5378 15.664 68.1458 15.312C68.7538 14.96 69.2418 14.448 69.6098 13.776C69.9938 13.088 70.1858 12.288 70.1858 11.376Z"
      fill="#D90A0A" />
  </svg>
  <form id="hd-chart-form">
    <table id="hd-chart-form-table">
      <tr>
        <th></th>
        <th>Design</th>
        <th>Personality</th>
      </tr>
    </table>
  </form>
  <div class="action">
    <button id="generate">Generate</button>
    <button id="cancel">Cancel</button>
  </div>
</div>
<script>

  const planets = [
    ['sun', 'â˜‰'],
    ['earth', 'ðŸœ¨'],
    ['moon', 'â˜½'],
    ['north', 'â˜Š'],
    ['south', 'â˜‹'],
    ['mercury', 'â˜¿'],
    ['venus', 'â™€'],
    ['mars', 'â™‚'],
    ['jupiter', 'â™ƒ'],
    ['saturn', 'â™„'],
    ['uranus', 'â™…'],
    ['neptune', 'â™†'],
    ['pluto', 'â™‡']
  ]

  window.addEventListener('load', () => {
    const rows = planets.map(([key, symbol], index) => {
      const tr = document.createElement('tr');

      const cell1 = document.createElement('td');
      cell1.append(symbol);

      const designInput = document.createElement('input');
      designInput.type = 'text';
      designInput.className = 'hd-input';
      designInput.name = `design.${key}`;
      designInput.onkeydown = (e) => {
        if (e.key === 'Enter') {
          const [nextKey] = planets[index + 1] || [];
          nextKey
            ? document.querySelector(`input[name="design.${nextKey}"]`).focus()
            : document.querySelector('input[name="personality.sun"]').focus();
        }
      }
      const cell2 = document.createElement('td');
      cell2.append(designInput);

      const personalityInput = document.createElement('input');
      personalityInput.type = 'text';
      personalityInput.className = 'hd-input';
      personalityInput.name = `personality.${key}`;
      personalityInput.onkeydown = (e) => {
        if (e.key === 'Enter') {
          const [nextKey] = planets[index + 1] || [];
          nextKey
            ? document.querySelector(`input[name="personality.${nextKey}"]`).focus()
            : document.getElementById('generate').onclick();
        }
      }
      const cell3 = document.createElement('td');
      cell3.append(personalityInput);

      tr.append(cell1, cell2, cell3);

      return tr;
    })

    document.getElementById('hd-chart-form-table').append(...rows);
  }, false);

  document.getElementById('generate').onclick = () => {
    try {
      document.getElementById('error-msg')?.remove();
      document.getElementById('hd-chart-form').disabled = true;
      document.getElementById('generate').disabled = true;
      const formData = new FormData(document.getElementById('hd-chart-form'));
      const value = {};
      for (let [key, input] of formData) {
        if (!input) {
          throw new Error('Empty input! Please fix it');
        }

        const [gate, profile] = input.split('.').map(d => +d || 0);
        if (gate === 0 || profile === 0 || gate > 64 || profile > 6) {
          throw new Error('Invalid input! Please fix it');
        }

        const [prefix, planet] = key.split('.');
        value[prefix] = {
          ...(value[prefix] || {}),
          [planet]: [gate, profile]
        }
      }
      parent.postMessage({ pluginMessage: { type: 'generate-all', value: JSON.stringify(value) } }, '*')
    } catch (e) {
      document.getElementById('hd-chart-form').disabled = false;
      document.getElementById('generate').disabled = false;

      const text = document.createElement('small');
      text.id = 'error-msg';
      text.append(e.message)
      document.getElementById('hd-chart-form').append(text);
    }
  }

</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap');

  body {
    font-family: 'Inter', sans-serif;
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
  }

  #hd-chart-form {
    margin-top: 16px;
  }

  #hd-chart-form-table th {
    font-size: 12px;
  }

  #hd-chart-form-table input[type=text] {
    width: 80px;
    outline: none;
    border: 0;
    border-radius: 0;
    border-bottom: 1px solid #d9d9d9;
    transition: 0.2s ease all;
    margin: 0 4px;
  }

  #hd-chart-form-table input[type=text]:focus {
    border-bottom: 2px solid #342973;
  }

  #error-msg {
    color: red;
    padding: 4px 0;
  }

  .action button {
    padding: 8px 12px;
    border-radius: 6px;
    border: 2px solid #342973;
    font-weight: 500;
    font-size: 13px;
  }

  .action button:disabled {
    opacity: 0.6;
  }

  .action button#generate {
    background-color: #342973;
    color: #fff;
  }
  
  .action button#cancel {
    background-color: #fff;
    color: #342973;
  }
</style>